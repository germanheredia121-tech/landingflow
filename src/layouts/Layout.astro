---
import "../styles/global.css";
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Landing Flow</title>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
		href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&display=swap"
		rel="stylesheet"/>
	</head>
	<body class="bg-gray-900 text-gray-100">
		<div class="snap-container">
			<slot />
		</div>
		<script is:inline>
			// TikTok/Reels style scroll snap - One scroll = One section
			(function() {
				let isScrolling = false;
				let currentSectionIndex = 0;
				let sections = [];
				
				function initSections() {
					sections = Array.from(document.querySelectorAll('section, .snap-section'));
				}
				
				function getCurrentSectionIndex() {
					const scrollPosition = window.scrollY;
					const viewportHeight = window.innerHeight;
					
					for (let i = 0; i < sections.length; i++) {
						const rect = sections[i].getBoundingClientRect();
						const sectionTop = rect.top + scrollPosition;
						
						// Check if we're in this section (within 50% of viewport)
						if (scrollPosition >= sectionTop - viewportHeight * 0.3 && 
						    scrollPosition < sectionTop + viewportHeight * 0.7) {
							return i;
						}
					}
					
					// Fallback: find nearest section
					let nearestIndex = 0;
					let minDistance = Infinity;
					sections.forEach((section, index) => {
						const rect = section.getBoundingClientRect();
						const sectionTop = rect.top + scrollPosition;
						const distance = Math.abs(scrollPosition - sectionTop);
						if (distance < minDistance) {
							minDistance = distance;
							nearestIndex = index;
						}
					});
					return nearestIndex;
				}
				
				function scrollToSection(index, direction) {
					if (isScrolling || index < 0 || index >= sections.length) return;
					
					const targetSection = sections[index];
					const rect = targetSection.getBoundingClientRect();
					const sectionTop = rect.top + window.scrollY;
					
					isScrolling = true;
					currentSectionIndex = index;
					
					window.scrollTo({
						top: sectionTop,
						behavior: 'smooth'
					});
					
					setTimeout(() => {
						isScrolling = false;
					}, 500);
				}
				
				// Handle wheel events - immediate snap on any scroll
				window.addEventListener('wheel', (e) => {
					if (isScrolling) {
						e.preventDefault();
						return;
					}
					
					initSections();
					currentSectionIndex = getCurrentSectionIndex();
					
					const deltaY = e.deltaY;
					
					if (deltaY > 0) {
						// Scrolling down - go to next section
						scrollToSection(currentSectionIndex + 1, 'down');
					} else if (deltaY < 0) {
						// Scrolling up - go to previous section
						scrollToSection(currentSectionIndex - 1, 'up');
					}
					
					e.preventDefault();
				}, { passive: false });
				
				// Handle scroll events as fallback
				window.addEventListener('scroll', () => {
					if (!isScrolling) {
						initSections();
						currentSectionIndex = getCurrentSectionIndex();
					}
				}, { passive: true });
				
				// Handle touch events for mobile
				let touchStartY = 0;
				let touchEndY = 0;
				
				document.addEventListener('touchstart', (e) => {
					touchStartY = e.touches[0].clientY;
					initSections();
					currentSectionIndex = getCurrentSectionIndex();
				}, { passive: true });
				
				document.addEventListener('touchend', (e) => {
					touchEndY = e.changedTouches[0].clientY;
					const diff = touchStartY - touchEndY;
					
					// If significant swipe, move to next/previous section
					if (Math.abs(diff) > 50) {
						if (diff > 0) {
							// Swiped down - go to next section
							scrollToSection(currentSectionIndex + 1, 'down');
						} else {
							// Swiped up - go to previous section
							scrollToSection(currentSectionIndex - 1, 'up');
						}
					}
				}, { passive: true });
				
				// Initialize on load
				window.addEventListener('load', () => {
					initSections();
					currentSectionIndex = getCurrentSectionIndex();
				});
			})();
		</script>
	</body>
</html>

<style>
	html {
		margin: 0;
		padding: 0;
		width: 100%;
		height: 100%;
	}
	
	body {
		margin: 0;
		padding: 0;
		width: 100%;
		overflow-x: hidden;
	}
	
	.snap-container {
		width: 100%;
		display: block;
	}
</style>
